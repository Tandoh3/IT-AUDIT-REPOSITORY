 IS Audit Script Set for Microsoft SQL Server		
1. Check if the sa Account is Disabled		
		
SELECT name AS login_name,		
       is_disabled,		
       create_date,		
       modify_date,		
       default_database_name,		
       is_policy_checked,		
       is_expiration_checked		
FROM sys.sql_logins		
WHERE name = 'sa';		
		
✅ is_disabled = 1 means sa is disabled (preferred).		
		
❌ is_disabled = 0 means sa is active — consider disabling or renaming it.		
		
		
		
-- 2. List All SQL Logins and Their Status		
		
SELECT name AS login_name,		
       type_desc AS login_type,		
       is_disabled,		
       default_database_name,		
       create_date,		
       modify_date		
FROM sys.server_principals		
WHERE type_desc IN ('SQL_LOGIN', 'WINDOWS_LOGIN', 'WINDOWS_GROUP')		
ORDER BY is_disabled, login_name;		
		
		
		
-- 3. Check Server Roles and Permissions		
		
-- List all server-level role members		
SELECT sp.name AS login_name,		
       slr.name AS server_role		
FROM sys.server_role_members srm		
JOIN sys.server_principals sp ON srm.member_principal_id = sp.principal_id		
JOIN sys.server_principals slr ON srm.role_principal_id = slr.principal_id;		
		
Focus on users with sysadmin, securityadmin, serveradmin roles.		
		
		
		
-- 4. Check Password Policy Enforcement		
		
SELECT name,		
       is_policy_checked AS password_policy_enforced,		
       is_expiration_checked AS password_expiry_enforced		
FROM sys.sql_logins		
WHERE type_desc = 'SQL_LOGIN';		
		
		
		
-- 5. Audit Logins with 'sysadmin' Role		
		
SELECT sp.name AS sysadmin_login		
FROM sys.server_role_members srm		
JOIN sys.server_principals sp ON srm.member_principal_id = sp.principal_id		
WHERE srm.role_principal_id = SUSER_ID('sysadmin');		
		
		
		
-- 6. Check if Login Auditing is Enabled		
		
-- 0 = None, 1 = Failed, 2 = Successful, 3 = Both		
EXEC xp_instance_regread 		
     N'HKEY_LOCAL_MACHINE',		
     N'Software\Microsoft\MSSQLServer\MSSQLServer',		
     N'AuditLevel';		
		
Recommended: AuditLevel = 3 (Success and Failure)		
		
		
		
-- 7. Check for Orphaned Users in Databases		
		
Run this per database:		
		
USE [YourDatabaseName];		
GO		
EXEC sp_change_users_login 'Report';		
		
Consider using sp_helpuser for a broader view:		
		
EXEC sp_helpuser;		
		
		
		
-- 8. Check for Users with CONTROL SERVER Privileges		
		
SELECT pr.name, pe.permission_name, pe.state_desc		
FROM sys.server_permissions pe		
JOIN sys.server_principals pr ON pe.grantee_principal_id = pr.principal_id		
WHERE pe.permission_name = 'CONTROL SERVER';		
		
		
		
-- 9. Check for Linked Servers		
		
SELECT name, data_source, provider_string, is_linked		
FROM sys.servers		
WHERE is_linked = 1;		
		
Review linked server security settings — these can be major risk points.		
		
		
		
-- 10. Check SQL Server Version and Patch Level		
		
SELECT 		
    SERVERPROPERTY('ProductVersion') AS ProductVersion,		
    SERVERPROPERTY('ProductLevel') AS ProductLevel,		
    SERVERPROPERTY('Edition') AS Edition,		
    SERVERPROPERTY('EngineEdition') AS EngineEdition;		
		
Compare against Microsoft's latest build list.		
		
		
		
-- 11. Check Backup Status for All Databases		
		
SELECT 		
    db.name AS DatabaseName,		
    MAX(b.backup_finish_date) AS LastBackup,		
    b.type AS BackupType		
FROM sys.databases db		
LEFT JOIN msdb.dbo.backupset b ON db.name = b.database_name		
WHERE db.name NOT IN ('tempdb')		
GROUP BY db.name, b.type		
ORDER BY db.name;		
		
BackupType: D = Full, I = Differential, L = Log		
		
		
		
-- 12. Encryption Status (TDE)		
		
SELECT 		
    db.name AS DatabaseName,		
    dm.encryption_state,		
    dm.key_algorithm,		
    dm.key_length		
FROM sys.dm_database_encryption_keys dm		
JOIN sys.databases db ON dm.database_id = db.database_id;		
		
encryption_state = 3 means the database is encrypted with TDE.		
		
Audit Area	          Notes
sa account status	Disable or rename if not used
Login accounts	        Check password & status
Sysadmin role members	Review regularly
Password policies	Enforce complexity and expiry
Audit level (login)	Set to level 3
Orphaned users	        Clean up unused users
Server permissions	Watch for CONTROL SERVER
Linked servers	        Review linked connections
SQL version & patch	Stay up-to-date
Backup validation	Ensure regular backups
TDE encryption	        Use for sensitive data


		
		
		

		
